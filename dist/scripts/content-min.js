const removeChildElementsById=e=>{const t=document.querySelector(e);if(t)for(;t.firstChild;)t.removeChild(t.firstChild)},fillElements=async()=>{document.querySelectorAll("#publish-targets .custom-domains").forEach((async(e,t)=>{let a=e.querySelector('[data-automation-id="publish-open-new-tab"]'),o=e.querySelector("#lock-"+t),l=e.querySelector("#unlock-"+t);const n=new URL(a.href).hostname;let i=await getItem(globalThis.collectionExEvent._id,n);if(l.classList.remove("f3_hidden"),o.classList.add("f3_hidden"),i.count>0){let a=i.items[0];if(a.domain==n&&!a.allow){document.getElementById("toggle-"+t).click();let n=e.querySelector(".wf-1apt7pe");childSideCheckbox=n.querySelector("div");let i=e.querySelector("#textarea-"+t);childSideCheckbox.classList.add("wf-fotvco"),childSideCheckbox.classList.remove("wf-1w47aue");n.querySelector("input").checked=!1,i.classList.remove("f3_hidden"),i.value=a.comment,o.classList.remove("f3_hidden"),l.classList.add("f3_hidden")}}}))},appendElements=()=>{setTimeout((()=>{document.querySelectorAll("#publish-targets .custom-domains").forEach(((e,t)=>{let a=document.getElementById("toggle-"+t),o=document.getElementById("textarea-"+t);if(!a&&!o){let a=document.createElement("li"),o=document.createElement("div");o.className="f3_container-flex";let l=document.createElement("div");l.className="f3_content-side";let n=document.createElement("div");n.className="f3_content-locks";let i=document.createElement("div");i.className="f3_lock f3_hidden",i.id="lock-"+t;let s=document.createElement("div");s.className="f3_unlock f3_hidden",s.id="unlock-"+t;let c=document.createElement("label");c.id="label-"+t,c.className="f3-inputs f3_label",c.textContent="Block Deploy *";let r=document.createElement("label");r.id="labelChbox-"+t,r.className="f3_switch-wrapper";let d=document.createElement("div");d.id="divChbox-"+t,d.className="f3_switch";let m=document.createElement("input");m.type="checkbox",m.id="toggle-"+t,m.className="f3-inputs f3_switch-checkbox",r.appendChild(m),r.appendChild(d);let h=document.createElement("textarea");h.id="textarea-"+t,h.className="f3-inputs f3_code f3_hidden",h.placeholder="Write a message to inform why",a.appendChild(o),n.appendChild(s),n.appendChild(i),n.appendChild(c),l.appendChild(n),l.appendChild(r),o.appendChild(l),a.appendChild(h),e.appendChild(a),document.getElementById(m.id).addEventListener("change",(async function(){let e=this.closest(".custom-domains"),t=e.querySelector(".wf-fotvco"),a=e.querySelector(".wf-1apt7pe");childSideCheckbox=a.querySelector("div");let o=e.querySelector("#"+h.id),l=e.querySelector("#"+i.id),n=e.querySelector("#"+s.id);const c=a.querySelector("input"),r=new MouseEvent("click",{bubbles:!0});if(this.checked)t||c.dispatchEvent(r),o.classList.remove("f3_hidden"),l.classList.remove("f3_hidden"),n.classList.add("f3_hidden"),o.value="";else{let a=e.querySelector('[data-automation-id="publish-open-new-tab"]'),i=e.querySelector(".f3_switch-checkbox");const s=new URL(a.href).hostname;let d={staging:!0,fields:{name:s+"-"+Date.now(),domain:s,user:globalThis.site.user.email,allow:!i.checked,comment:"",_archived:!1,_draft:!0}};t&&c.dispatchEvent(r),o.classList.add("f3_hidden"),o.value="",l.classList.add("f3_hidden"),n.classList.remove("f3_hidden"),await createItem(globalThis.collectionExEvent._id,d)}})),document.getElementById(h.id).addEventListener("change",(async function(){let e=this.closest(".custom-domains"),t=e.querySelector('[data-automation-id="publish-open-new-tab"]'),a=e.querySelector(".f3_switch-checkbox");const o=new URL(t.href).hostname;let l={staging:!0,fields:{name:o+"-"+Date.now(),domain:o,user:globalThis.site.user.email,allow:!a.checked,comment:this.value,_archived:!1,_draft:!0}};await createItem(globalThis.collectionExEvent._id,l)}))}})),fillElements()}),1e3)},getCSRFToken=()=>document.head.querySelector('meta[name="_csrf"]')?.getAttribute("content")||"",createCollection=async()=>{try{let e=new Headers;e.append("Content-Type","application/json"),e.append("X-XSRF-Token",getCSRFToken());let t={method:"POST",headers:e,body:JSON.stringify({name:"exEvents",slug:"exevents",singularName:"Extension Events",fields:[{name:"domain",type:"PlainText"},{name:"user",type:"PlainText"},{name:"allow",type:"Bool"},{name:"comment",type:"PlainText"}]}),redirect:"follow"},a=await fetch("https://webflow.com/api/sites/"+getSiteName()+"/collectionPage",t);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(e){return[]}},createDatabase=async()=>{try{let e={name:getSiteName()+"'s' Database",description:getSiteName()+"'s' Database",collections:[],assetSize:0,createdOn:"2023-05-16T20:16:14.377Z",lastUpdated:"2023-05-16T20:16:14.417Z",archived:!1,stagingMeta:{},maxItemRefs:10,maxFieldLimit:100,maxItemLimit:2e4,maxEcomItemLimit:2500,maxLocales:2,maxCollectionLimit:100},t=new Headers;t.append("Content-Type","application/json"),t.append("X-XSRF-Token",getCSRFToken());let a={method:"POST",headers:t,body:JSON.stringify(e),redirect:"follow"},o=await fetch("https://webflow.com/api/sites/"+getSiteName()+"/database",a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(e){return[]}},createItem=async(e,t)=>{try{let a=new Headers;a.append("Content-Type","application/json"),a.append("X-XSRF-Token",getCSRFToken());let o={method:"POST",headers:a,body:JSON.stringify(t),redirect:"follow"},l=await fetch("https://webflow.com/api/v1/collections/"+e+"/items",o);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(e){return[]}},getItem=async(e,t)=>{try{let a=new Headers;a.append("Content-Type","application/json"),a.append("X-XSRF-Token",getCSRFToken());let o={method:"GET",headers:a,redirect:"follow"},l=await fetch("https://webflow.com/api/v1/collections/"+e+"/items?target=staging&offset=0&limit=1&sort%5B%5D=-created-on&format=withoutHeavyFields&text="+t,o);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(e){return[]}},getAllItems=async e=>{try{let t=new Headers;t.append("Content-Type","application/json"),t.append("X-XSRF-Token",getCSRFToken());let a={method:"GET",headers:t,redirect:"follow"},o=await fetch("https://webflow.com/api/v1/collections/"+e+"/items?target=staging&offset=10&limit=10&sort%5B%5D=-created-on&format=withoutHeavyFields",a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(e){return[]}},getCollections=async e=>{try{let t=new Headers;t.append("Content-Type","application/json"),t.append("X-XSRF-Token",getCSRFToken());let a={method:"GET",headers:t,redirect:"follow"},o=await fetch("https://webflow.com/api/v1/databases/"+e+"/collections",a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(e){return[]}},deleteItems=async(e,t)=>{try{let a=new Headers;a.append("Content-Type","application/json"),a.append("X-XSRF-Token",getCSRFToken());let o={method:"DELETE",headers:a,body:JSON.stringify(t),redirect:"follow"},l=await fetch("https://webflow.com/api/v1/collections/"+e+"/items",o);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(e){return[]}},getSiteName=()=>{let e=window.location.href,t="";return e.includes("https://webflow.com/design/")&&(t=e.split("https://webflow.com/design/")[1].split("/")[0]),t},getSite=async()=>{const e={method:"GET",headers:{"Content-Type":"application/json"}};try{let t=await fetch("https://webflow.com/api/sites/"+getSiteName(),e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(e){}},existPublishButton=()=>null!=document.querySelector('[data-automation-id="publish-menu-button"]'),publishHandler=()=>{let e=document.querySelector('[data-automation-id="publish-menu-button"]');null==e||setTimeout((()=>{e.onclick=appendElements}),4e3)},init=async()=>{if(globalThis.site=await getSite(),globalThis.collectionExEvent=null,null==globalThis.site.site.database){let e=await createDatabase();globalThis.site.site.database=e._id}if(globalThis.collections=await getCollections(globalThis.site.site.database),globalThis.collectionExEvent=globalThis.collections.collections.find((e=>"exEvents"==e.name)),null==collectionExEvent&&(globalThis.collectionExEvent=await createCollection()),globalThis.collectionExEvent.totalNumberOfItems>10){let e=(await getAllItems(globalThis.collectionExEvent._id)).items.map((e=>e._id));await deleteItems(globalThis.collectionExEvent._id,{itemIds:e})}const e=setInterval(publishHandler,1e4),t=setInterval((()=>{null!=document.querySelector('[data-automation-id="publish-menu-button"]')&&(clearInterval(e),clearInterval(t))}),1e4)};init();